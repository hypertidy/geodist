<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>geodist • geodist</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="geodist">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">geodist</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0.011</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/geodist.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/hypertidy/geodist/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>geodist</h1>
                        <h4 data-toc-skip class="author">Mark
Padgham</h4>
            
            <h4 data-toc-skip class="date">2024-11-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/hypertidy/geodist/blob/main/vignettes/geodist.Rmd" class="external-link"><code>vignettes/geodist.Rmd</code></a></small>
      <div class="hidden name"><code>geodist.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="geodist">geodist<a class="anchor" aria-label="anchor" href="#geodist"></a>
</h2>
<p>An ultra-lightweight, zero-dependency package for very fast
calculation of geodesic distances. Main eponymous function,
<code><a href="../reference/geodist.html">geodist()</a></code>, accepts only one or two primary arguments, which
must be rectangular objects with unambiguously labelled longitude and
latitude columns (that is, some variant of
<code>lon</code>/<code>lat</code>, or
<code>x</code>/<code>y</code>).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span> <span class="op">(</span><span class="op">-</span><span class="fl">10</span> <span class="op">+</span> <span class="fl">20</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span> <span class="op">(</span><span class="va">n</span><span class="op">)</span>, <span class="op">-</span><span class="fl">10</span> <span class="op">+</span> <span class="fl">20</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span> <span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span> <span class="op">(</span><span class="op">-</span><span class="fl">10</span> <span class="op">+</span> <span class="fl">20</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">n</span><span class="op">)</span>, <span class="op">-</span><span class="fl">10</span> <span class="op">+</span> <span class="fl">20</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span> <span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span> <span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span></span>
<span><span class="va">d0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/geodist.html">geodist</a></span> <span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="co"># A 50-by-50 matrix</span></span>
<span><span class="va">d1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/geodist.html">geodist</a></span> <span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="co"># A 50-by-100 matrix</span></span>
<span><span class="va">d2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/geodist.html">geodist</a></span> <span class="op">(</span><span class="va">x</span>, sequential <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># Vector of length 49</span></span>
<span><span class="va">d2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/geodist.html">geodist</a></span> <span class="op">(</span><span class="va">x</span>, sequential <span class="op">=</span> <span class="cn">TRUE</span>, pad <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># Vector of length 50</span></span></code></pre></div>
<div class="section level3">
<h3 id="detailed-usage">Detailed Usage<a class="anchor" aria-label="anchor" href="#detailed-usage"></a>
</h3>
<p>Input(s) to the <code><a href="../reference/geodist.html">geodist()</a></code> function can be in arbitrary
rectangular format.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1e1</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span> <span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="op">-</span><span class="fl">180</span> <span class="op">+</span> <span class="fl">360</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span> <span class="op">(</span><span class="va">n</span><span class="op">)</span>,</span>
<span>    y <span class="op">=</span> <span class="op">-</span><span class="fl">90</span> <span class="op">+</span> <span class="fl">180</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span> <span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span> <span class="op">(</span><span class="fu"><a href="../reference/geodist.html">geodist</a></span> <span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 10 10</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span> <span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="op">-</span><span class="fl">180</span> <span class="op">+</span> <span class="fl">360</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">n</span><span class="op">)</span>,</span>
<span>    y <span class="op">=</span> <span class="op">-</span><span class="fl">90</span> <span class="op">+</span> <span class="fl">180</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">n</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span> <span class="op">(</span><span class="fu"><a href="../reference/geodist.html">geodist</a></span> <span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 10 20</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span> <span class="op">(</span></span>
<span>    <span class="op">-</span><span class="fl">180</span> <span class="op">+</span> <span class="fl">360</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span> <span class="op">(</span><span class="va">n</span><span class="op">)</span>,</span>
<span>    <span class="op">-</span><span class="fl">90</span> <span class="op">+</span> <span class="fl">100</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span> <span class="op">(</span><span class="va">n</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span> <span class="op">(</span><span class="va">n</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span> <span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span> <span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="st">"lon"</span>, <span class="st">"lat"</span>, <span class="st">"a"</span>, <span class="st">"b"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span> <span class="op">(</span><span class="fu"><a href="../reference/geodist.html">geodist</a></span> <span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 10 10</span></span></code></pre></div>
<p>All outputs are distances in metres, calculated with a variety of
spherical and elliptical distance measures. Distance measures currently
implemented are Haversine, Vincenty (spherical), the very fast <a href="https://github.com/mapbox/cheap-ruler-cpp/blob/master/include/mapbox/cheap_ruler.hpp" class="external-link">mapbox
cheap ruler</a> (see their <a href="https://blog.mapbox.com/fast-geodesic-approximations-with-cheap-ruler-106f229ad016" class="external-link">blog
post</a>), and the “reference” implementation of <a href="https://link.springer.com/content/pdf/10.1007/s00190-012-0578-z.pdf" class="external-link">Karney
(2013)</a>, as implemented in the package <a href="https://cran.r-project.org/package=sf" class="external-link"><code>sf</code></a>. (Note
that <code>geodist</code> does not accept <a href="https://cran.r-project.org/package=sf" class="external-link"><code>sf</code></a>-format
objects; the <a href="https://cran.r-project.org/package=sf" class="external-link"><code>sf</code></a> package
itself should be used for that.) Note that The <a href="https://github.com/mapbox/cheap-ruler-cpp" class="external-link">mapbox cheap ruler
algorithm</a> is intended to provide approximate yet very fast distance
calculations within small areas (typically the size of single cities or
study sites).</p>
<div class="section level4">
<h4 id="benchmarks-of-geodesic-accuracy">Benchmarks of geodesic accuracy<a class="anchor" aria-label="anchor" href="#benchmarks-of-geodesic-accuracy"></a>
</h4>
<p>The <code><a href="../reference/geodist_benchmark.html">geodist_benchmark()</a></code> function - the only other
function provided by the <code>geodist</code> package - compares the
accuracy of the different metrics to the nanometre-accuracy standard of
<a href="https://link.springer.com/content/pdf/10.1007/s00190-012-0578-z.pdf" class="external-link">Karney
(2013)</a>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/geodist_benchmark.html">geodist_benchmark</a></span> <span class="op">(</span>lat <span class="op">=</span> <span class="fl">30</span>, d <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="co">#&gt;            haversine    vincenty       cheap</span></span>
<span><span class="co">#&gt; absolute 0.836551561 0.836551562 0.594188257</span></span>
<span><span class="co">#&gt; relative 0.002155514 0.002155514 0.001616718</span></span></code></pre></div>
<p>All distances (<code>d)</code> are in metres, so that result
indicates that all measures are accurate to within 1m over distances out
to several km. The following plots compare the absolute and relative
accuracies of the different distance measures implemented here. The
mapbox cheap ruler algorithm is the most accurate for distances out to
around 100km, beyond which it becomes extremely inaccurate. Average
relative errors of Vincenty distances remain generally constant at
around 0.2%, while relative errors of cheap-ruler distances out to 100km
are around 0.16%.</p>
<p><img src="fig1.png"></p>
</div>
<div class="section level4">
<h4 id="performance-comparison">Performance comparison<a class="anchor" aria-label="anchor" href="#performance-comparison"></a>
</h4>
<p>The following code demonstrates the relative speed advantages of the
different distance measures implemented in the <code>geodist</code>
package.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1e3</span></span>
<span><span class="va">dx</span> <span class="op">&lt;-</span> <span class="va">dy</span> <span class="op">&lt;-</span> <span class="fl">0.01</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span> <span class="op">(</span><span class="op">-</span><span class="fl">100</span> <span class="op">+</span> <span class="va">dx</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span> <span class="op">(</span><span class="va">n</span><span class="op">)</span>, <span class="fl">20</span> <span class="op">+</span> <span class="va">dy</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span> <span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span> <span class="op">(</span><span class="op">-</span><span class="fl">100</span> <span class="op">+</span> <span class="va">dx</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">n</span><span class="op">)</span>, <span class="fl">20</span> <span class="op">+</span> <span class="va">dy</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span> <span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span> <span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span></span>
<span><span class="fu">rbenchmark</span><span class="fu">::</span><span class="fu">benchmark</span> <span class="op">(</span></span>
<span>    replications <span class="op">=</span> <span class="fl">10</span>, order <span class="op">=</span> <span class="st">"test"</span>,</span>
<span>    <span class="va">d1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/geodist.html">geodist</a></span> <span class="op">(</span><span class="va">x</span>, measure <span class="op">=</span> <span class="st">"cheap"</span><span class="op">)</span>,</span>
<span>    <span class="va">d2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/geodist.html">geodist</a></span> <span class="op">(</span><span class="va">x</span>, measure <span class="op">=</span> <span class="st">"haversine"</span><span class="op">)</span>,</span>
<span>    <span class="va">d3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/geodist.html">geodist</a></span> <span class="op">(</span><span class="va">x</span>, measure <span class="op">=</span> <span class="st">"vincenty"</span><span class="op">)</span>,</span>
<span>    <span class="va">d4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/geodist.html">geodist</a></span> <span class="op">(</span><span class="va">x</span>, measure <span class="op">=</span> <span class="st">"geodesic"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="co">#&gt;                                      test replications elapsed relative</span></span>
<span><span class="co">#&gt; 1     d1 &lt;- geodist(x, measure = "cheap")           10   0.058    1.000</span></span>
<span><span class="co">#&gt; 2 d2 &lt;- geodist(x, measure = "haversine")           10   0.185    3.190</span></span>
<span><span class="co">#&gt; 3  d3 &lt;- geodist(x, measure = "vincenty")           10   0.276    4.759</span></span>
<span><span class="co">#&gt; 4  d4 &lt;- geodist(x, measure = "geodesic")           10   3.106   53.552</span></span></code></pre></div>
<p>Geodesic distance calculation is available in the <a href="https://cran.r-project.org/package=sf" class="external-link"><code>sf</code>
package</a>. Comparing computation speeds requires conversion of sets of
numeric lon-lat points to <code>sf</code> form with the following
code:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span> <span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span><span class="va">x_to_sf</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span> <span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, <span class="kw">function</span> <span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu">sf</span><span class="fu">::</span><span class="fu">st_point</span> <span class="op">(</span><span class="va">x</span> <span class="op">[</span><span class="va">i</span>, <span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>            <span class="fu">sf</span><span class="fu">::</span><span class="fu">st_sfc</span> <span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu">sf</span><span class="fu">::</span><span class="fu">st_sfc</span> <span class="op">(</span>crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1e2</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span> <span class="op">(</span><span class="op">-</span><span class="fl">180</span> <span class="op">+</span> <span class="fl">360</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span> <span class="op">(</span><span class="va">n</span><span class="op">)</span>, <span class="op">-</span><span class="fl">90</span> <span class="op">+</span> <span class="fl">180</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span> <span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span> <span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span></span>
<span><span class="va">xsf</span> <span class="op">&lt;-</span> <span class="fu">x_to_sf</span> <span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="va">sf_dist</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu">st_distance</span> <span class="op">(</span><span class="va">x</span>, <span class="va">x</span><span class="op">)</span></span>
<span><span class="va">geo_dist</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="../reference/geodist.html">geodist</a></span> <span class="op">(</span><span class="va">x</span>, measure <span class="op">=</span> <span class="st">"geodesic"</span><span class="op">)</span></span>
<span><span class="fu">rbenchmark</span><span class="fu">::</span><span class="fu">benchmark</span> <span class="op">(</span></span>
<span>    replications <span class="op">=</span> <span class="fl">10</span>, order <span class="op">=</span> <span class="st">"test"</span>,</span>
<span>    <span class="fu">sf_dist</span> <span class="op">(</span><span class="va">xsf</span><span class="op">)</span>,</span>
<span>    <span class="fu">geo_dist</span> <span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="co">#&gt; Linking to GEOS 3.6.2, GDAL 2.3.0, proj.4 5.0.1</span></span>
<span><span class="co">#&gt;           test replications elapsed relative</span></span>
<span><span class="co">#&gt; 2  geo_dist(x)           10   0.066    1.000</span></span>
<span><span class="co">#&gt; 1 sf_dist(xsf)           10   0.210    3.182</span></span></code></pre></div>
<p>Confirm that the two give almost identical results:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span> <span class="op">(</span><span class="fu">sf_dist</span> <span class="op">(</span><span class="va">xsf</span><span class="op">)</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span> <span class="op">(</span><span class="va">xsf</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/geodist.html">geodist</a></span> <span class="op">(</span><span class="va">x</span>, measure <span class="op">=</span> <span class="st">"geodesic"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/formatc.html" class="external-link">formatC</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span> <span class="op">(</span><span class="va">ds</span> <span class="op">-</span> <span class="va">dg</span><span class="op">)</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"e"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "7.4506e-09"</span></span></code></pre></div>
<p>All results are in metres, so the two differ by only around 10
nanometres.</p>
<p>The <a href="https://cran.r-project.org/package=geosphere" class="external-link"><code>geosphere</code>
package</a> also offers sequential calculation which is benchmarked with
the following code:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fgeodist</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="op">)</span> <span class="fu"><a href="../reference/geodist.html">geodist</a></span> <span class="op">(</span><span class="va">x</span>, measure <span class="op">=</span> <span class="st">"vincenty"</span>, sequential <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">fgeosph</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="op">)</span> <span class="fu">geosphere</span><span class="fu">::</span><span class="fu">distVincentySphere</span> <span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="fu">rbenchmark</span><span class="fu">::</span><span class="fu">benchmark</span> <span class="op">(</span></span>
<span>    replications <span class="op">=</span> <span class="fl">10</span>, order <span class="op">=</span> <span class="st">"test"</span>,</span>
<span>    <span class="fu">fgeodist</span> <span class="op">(</span><span class="op">)</span>,</span>
<span>    <span class="fu">fgeosph</span> <span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="co">#&gt;         test replications elapsed relative</span></span>
<span><span class="co">#&gt; 1 fgeodist()           10   0.022    1.000</span></span>
<span><span class="co">#&gt; 2  fgeosph()           10   0.048    2.182</span></span></code></pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Mark Padgham, Michael D. Sumner.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
